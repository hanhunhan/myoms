<!DOCTYPE html>
<html>
<head>
    <title>项目终止</title>
    <meta charset="GBK">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!--<link href="./Public/css/style2.css" type="text/css" rel="stylesheet"/>-->
    <!--<link href="./Public/css/jquery-ui.css" type="text/css" rel="stylesheet"/>-->
    <!--<script type="text/javascript" src="./Public/validform/js/jquery-1.9.1.min.js"></script>-->
    <!--<script type="text/javascript" src="./Public/validform/js/Validform_v5.3.2.js"></script>-->
    <!--<script type="text/javascript" src="./Public/validform/js/common.js"></script>-->
    <!--<script type="text/javascript" src="./Public/js/common.js"></script>-->
    <!--<script language="javascript" type="text/javascript" src="./Public/My97DatePicker/WdatePicker.js"></script>-->
    <!--<script type="text/javascript" src="./Public/js/jquery-ui.js"></script>-->
    <!--<link rel="stylesheet" href="./Public/validform/css/style.css" type="text/css" media="all"/>-->
    <!--<link rel="stylesheet" href="./Public/validform/css/validateForm.css" type="text/css" media="all"/>-->
    <include file="./Tpl/Admin/Public/comm_css_js.html"/>
    <style>
        .ui-autocomplete {
            max-height: 200px;
            overflow-y: auto;
            /* 防止水平滚动条 */
            overflow-x: hidden;
        }
    </style>
    <script>
        $(document).ready(function () {
            $("#ifm").attr('height', 300);
        });
    </script>
</head>
<body>
<div class="containter">
    <div class="right fright j-right">
        <if condition="$layer eq 1">
            <div style="margin:0 auto;width:200px;">
                <foreach name="business" item="vo">
                    <input type="checkbox" name="businesstype" value="{$vo.CASEID}" <if condition='$vo.disable eq 1'> disabled="disabled" </if> />
                    <lable>{$vo.YEWU}</lable>
                    <br><br>
                </foreach>
                <br>
                <input type="button" name="submitThis" onclick="submitThis();" class="btn-blue" value="确定">
                <input type="button" name="detailThis" onclick="detailThis();" class="btn-gray" value="详情">
                <input type="button" name="cancelThis" onclick="parent.layer.closeAll();" class="btn-gray" value="取消">
            </div>
            <else/>
            <div class="handle-tab ">
                <ul>
                    <li class="selected"><a href="{:U('Case/project_termination',$paramUrl)}">项目终止</a></li>
                    <if condition="$RECORDID neq null">
                        <li><a href="{:U('Case/opinionFlow_termination',$paramUrl)}">审批意见</a></li>
                    </if>
                </ul>
            </div>
            {$form}
        </if>
        <script>
            //提交
            function submitThis() {
                var chk_value = [];
                $('input[name="businesstype"]:checked').each(function () {
                    chk_value.push($(this).val());
                });
                var blength = $('input[name="businesstype"]').length;
                //if(chk_value.length>0 ){
                var str = chk_value.join(',');
                parent.termination(str, blength);
                //}else alert('请选择类型');
            }
            //查看
            function detailThis() {
                var prjid = '{$prjid}';
                url = '__APP__' + '/Case/project_termination/prjid/' + prjid;
                window.parent.location.href = url;
            }
            // 撤销所选的类型
            function canelcase() {
                var prjid = '{$prjid}';
                var thisid = $(".contractinfo-table tbody .selected").attr('fid');
                url = appUrl + '/Case/project_termination/prjid/' + prjid;
                if (thisid) {
                    $.ajax({
                        url: url,
                        dataType: "json",
                        data: {
                            act: 'canelcase',
                            fcid: thisid
                        },
                        success: function (data) {
                            if (data.status == 'y') {
                                alert(data.info);
                                window.location.href = url;
                            } else alert(data.info);

                        }

                    });

                } else alert('请选择要撤销类型');
            }
            //提交
            function termination_flow() {
                var thisid = $(".contractinfo-table tbody .selected").attr('fid');
                var tags = thisid + "_" + "STATUS";
                var status = $("[name='" + tags + "']").val();

                var url = "{:U('Case/opinionFlow_termination',$paramUrl)}" + '&RECORDID=' + thisid;
                if (thisid) {
                    if (status == 1 || status == 2) {
                        alert('请不要重复提交');
                    } else
                        window.location.href = url;

                } else alert('请选择要提交的类型');

            }
        </script>
    </div>
</div>
</body>
</html>
