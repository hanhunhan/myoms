<!DOCTYPE html>
<html>
<head>
    <title>划拨明细</title>
    <meta charset="GBK">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="Public/third/bootstrap/css/bootstrap.min.css" rel="stylesheet">
    <link href="./Public/css/style2.css" type="text/css" rel="stylesheet"/>
    <script type="text/javascript" src="./Public/validform/js/jquery-1.9.1.min.js"></script>
    <script type="text/javascript" src="./Public/js/common.js"></script>
    <script src="./Public/third/jquery_ui_autocomplete/ui/jquery.ui.core.js"></script>
    <script src="./Public/third/jquery_ui_autocomplete/ui/jquery.ui.widget.js"></script>
    <script src="./Public/third/jquery_ui_autocomplete/ui/jquery.ui.position.js"></script>
    <script language="javascript" type="text/javascript" src="./Public/layer/layer.js"></script>
    <script src="Public/third/bootstrap/js/bootstrap.min.js"></script>
</head>
<body>
<div class="containter">
    <div class="right fright j-right">
        {$form}
    </div>
</div>

<script>
    var bus_project = "<php>echo $bus_project</php>";
    var bus_sel_pro = JSON.parse('<php>echo $bus_sel_pro</php>');
    var project_id = "<php>echo $project_id</php>";
    var project_type_id = "<php>echo $project_type_id</php>";
    var id = 0;

    $(document).ready(function () {
        $(".share_fundpool_cost").each(function () {
            id = $(this).attr("idval");
            //如果两者都是非电商
            if (!bus_project || !bus_sel_pro[id]) {
                $(this).hide();
            }
        });
    });

    $("#allocation_examine").click(function () {

        //填写数据监测
        $("input[idval]").each(function () {
            if ($(this).val() != '' && isNaN($(this).val())) {
                layer.alert('填写的值必须为数字，谢谢!', {icon: 2});
                return false;
            }
        });

        //获取ids
        var ids = '';
        $(".itemlist").each(function () {
            ids += $(this).attr('fid') + ",";
        });

        $.ajax({
            type: "POST",
            url: "index.php?s=/Cost/allocationApply",
            data: {
                'act': 'examine',
                'project_id': project_id,
                'project_type_id': project_type_id,
                'ids': ids,
                'formdata': $('.registerform').serialize()
            },
            dataType: "JSON",
            success: function (data) {
                alert(data.status);
                if (data.status == 0) {
                    alert(data.msg);
                    layer.alert(data.msg, {icon: 2});
                }
                else if (data.status == 1) {
                    var caseid = data.data.caseid;
                    var allocation_id = data.data.allocation_id;
                    window.location.href = "index.php?s=/Cost/opinionFlow/CASEID/" + caseid + "/RECORDID/" + allocation_id;
                }
                else {
                    var msg = data.msg ? data.msg : '操作异常';
                    layer.alert(msg, {icon: 2});
                }
            }
        })
    });
</script>
</body>
</html>