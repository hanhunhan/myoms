<style>
    .logoupload{height:50px;padding:20px 0 0 0;}
    .logoupload .uploadtip{float:left;padding:5px 10px;background:#E8F0FF;border:solid 1px #BCD2FF;line-height:18px;margin:8px 0 0 15px;display:inline;color:#5e5e5e;}
    .logoupload .uploadtip b{color:#ff6600;margin:0 5px;}
    .logoupload .btnbox{width:143px;height:45px;float:left;}
    .logoupload .fl-progress{float:left;margin-top:0!important;margin-left:20px;display:inline;}
    .logoupload .uploadbtn{float:left;width:145px;height:47px;line-height:999em;overflow:hidden;font-size:14px;display:block;color:#ffffff;}
    /* batch-pic */
     .p-pic{border:solid 1px #d8d8d8;height:110px;overflow:hidden;}
    .p-pic img{width:200px;}
    .delete-pic {background:url(http://newscms.house365.com/js/SWFUpload/images/red-close-btn.gif) no-repeat;width:27px;height:27px;overflow:hidden;cursor:pointer;position:absolute;right:-7px;top:-13px;}
    .resizebox{position: relative;width: 200px;}
    .logobox{margin-top: 10px;}
</style>

<div class="box" id="interestManage">

    <div class="box-tit"><h3>模块节点设置</h3></div>
    <div class="box-con" >
        <form method="POST" action="{:U('HomeLayout/moduleAttrCurd')}" onsubmit="sub();return false;">
        <div class="c-tit"><h4>基本属性设置</h4></div>
            <div class="bd">
                <table class="table2" width="98%">
                    <tr>
                        <td width="15%">排序</td>
                        <td width="85%">
                            <input type="text" id="rank" name="rank" value="<?=$itemData['rank']?>">
                        </td>
                    </tr>
                    <tr>
                        <td width="15%">扩展分类</td>
                        <td width="85%">
                          <?=W('HomeLayout',$widgetData,false)?>
                        </td>
                    </tr>

                </table>
            </div>
        <div class="c-tit"><h4>模块节点设置</h4></div>

            <div class="bd">
                    <?php
                        $pic_orderNum = 0;
                    ?>
                    <?php foreach($attrList as $attr){?>
                        <fieldset style="padding: 2px;margin-top:10px;margin-bottom:10px;">
                            <legend>
                                模块属性-【<?=$attr['cName']?>】&nbsp;&nbsp;
                            </legend>
                            <table class="table2" width="98%" tag="<?=$attr['aId']?>">
                                <tr>
                                    <td width="15%"><?=$attr['cName']?></td>
                                    <td width="85%">
                                        <input  style="width: 50%"  type="text" name="title" value="<?=$itemList[$attr['aId']]['title']?>">
                                    </td>
                                </tr>
                            <!--  可选配置项 url-->

                            <?php if(in_array(1,$attr['extSelect'])){?>
                                    <tr>
                                        <td width="15%">链接地址</td>
                                        <td width="85%">
                                            <input  style="width: 50%"  type="text" name="url" value="<?=$itemList[$attr['aId']]['url']?>">
                                        </td>
                                    </tr>
                            <?php }?>

                            <!--  可选配置项 pic-->
                            <?php if(in_array(2,$attr['extSelect'])){?>
                                        <tr>
                                            <td width="15%">上传图片</td>
                                            <td width="85%">
                                                <div class="logobox" >
                                                    <div class="resizebox ">
                                                        <div class="delete-pic"></div>
                                                        <div class="p-pic">
                                                            <?php if($itemList[$attr['aId']]['pic']){?>
                                                                <img src="<?=$itemList[$attr['aId']]['pic']?>" width="200px">
                                                             <?php }?>
                                                        </div>
                                                    </div>
                                                </div>
                                                <div class="logoupload" tag="">
                                                    <div class="btnbox">
                                                        <a id="singleUploadBtnHolder_<?=$itemList['itemId']?>" class="uploadbtn" href="javascript:;">上传替换</a>
                                                    </div>
                                                    <div style="clear:both;height:0;overflow:hidden;"></div>
                                                    <div class="new-progress-box fl-progress progress-box<?=$pic_orderNum?>" style="display:none;">
                                                        <div class="progress-num">上传进度：<b>0%</b></div>
                                                        <div class="progress-bar"><div style="width:0%;" class="bar-line"></div></div>
                                                    </div>
                                                </div>
                                            </td>
                                        </tr>
                                <?php $pic_orderNum++;?>
                            <?php }?>
                                </table>
                            </fieldset>
                    <?php }?>
                <div class="center-btn mt10"  style="margin:20px;">
                    <input type="submit"  value="确定" class="btn-a mr50" >
                    <input  type="button" class="btn-a" onclick="history.go(-1)" value="返回"/>
                </div>
                <input name='curdType' type='hidden' value='<?=$_GET[curdType]?>'>
                <input name='itemId' id="itemId" type='hidden' value='<?=$itemId?>'>
                <input name='moduleId' id="moduleId" type='hidden' value='<?=$moduleId?>'>
            </div>
        </form>
    </div>
</div>

<script type="text/javascript" src="http://newscms.house365.com/js/SWFUpload/diysubject_swfupload/swfupload.js"></script>
<script type="text/javascript" src="http://newscms.house365.com/js/SWFUpload/diysubject_swfupload/swfupload.queue.js"></script>
<script type="text/javascript" src="http://newscms.house365.com/js/SWFUpload/diysubject_swfupload/swfupload.speed.js"></script>
<script type="text/javascript" src="http://newscms.house365.com/js/SWFUpload/diysubject_swfupload/handlers.js"></script>
<!--图片JS处理-->
<script type="application/javascript" src="./Public/Js/moduleItemPic.js"></script>

<script>
    //ajax提交
    function sub(){
        var itemId = $("#itemId").val();
        var moduleId = $("#moduleId").val();
        var rank = $("#rank").val();
        var extId = $("#extId").val();
        var data = [];
        $(".table2").each(function(){
            var pointData = {};
            pointData.title = $(this).find("input[name=title]").val();
            pointData.url = $(this).find('input[name=url]').val();
            pointData.pic = $(this).find('.p-pic img').attr('src');
            pointData.aId = $(this).attr('tag');
            data.push(pointData);
        });
        $.ajax({
            url:"{:U('HomeLayout/moduleItemCurd')}",
            data:{
                        formData:data,
                        itemId:itemId,
                        moduleId:moduleId,
                        rank:rank,
                        extId:extId
                    },
            type:'post',
            success:function(res){
                if(res==1){
                    alert('保存成功');
                }else{
                    alert('保存失败')
                }
                location.href = "<?=U('HomeLayout/moduleItemList',array('moduleId'=>$moduleId,'t'=>time()))?>";
            }
        })
    }

</script>