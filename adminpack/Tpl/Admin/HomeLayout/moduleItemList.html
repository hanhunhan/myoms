<div class="box" >
    <div class="box-tit"><h3>模块节点列表</h3></div>
    <div class="box-con">
        <!--  查询条件-->
          <form action="{:U('HomeLayout/moduleItemList',array('moduleId'=>$_GET['moduleId']))}" method="post">
                    <div class="c-tit"><h4>搜索条件</h4></div>
                    <div class="search-condition">

                        <div class="search-con">
                            <?php if($widgetData){?>
                                    <?=($moduleRes['extClassifyName'])?$moduleRes['extClassifyName']:'扩展分类';?>：
                                    <?=W('HomeLayout',$widgetData,false)?>
                            <?php }?>
                            &nbsp;&nbsp; &nbsp;&nbsp;&nbsp;&nbsp;
                           状态： <select name="del">
                                <option value="">请选择</option>
                                <option value="0" <?php if($_POST['del']!='' && $_POST['del']==0){?> selected="selected" <?php }?>>启用</option>
                                <option value="1" <?php if($_POST['del']==1){?> selected="selected" <?php }?>>停用</option>
                            </select>
                            <input type="submit" value="搜索" style="width:50px">
                        </div>
                    </div>
                </form>
        <div class="box-b">
            <div class="hd"><h3>模块节点列表</h3></div>
            <div class="bd">
                <table width="100%" border="0" cellspacing="0" cellpadding="0" class="table-a">
                    <tr>
                        <th>节点序号</th>
                        <th>节点内容</th>
                        <th>隶属模块</th>
                        <th><?=($moduleRes['extClassifyName'])?$moduleRes['extClassifyName']:'扩展分类';?></th>
                        <th>排序</th>
                        <th>状态</th>
                        <th><a class="font-blue" href="<?=U('HomeLayout/moduleItemCurd',array('moduleId'=>$_GET['moduleId']))?>">添加模块</a></th>
                    </tr>
                    <?php foreach($listData as $list){?>
                    <?php $currentItemList = unserialize($list['jsonContent']);?>
                    <tr>
                        <td width="5%"><?=$list['itemId']?></td>
                        <td width="30%">
                                    <table style="width: 100%;border:0px ;">
                                        <?php foreach($attrList as $attr){?>
                                            <tr>
                                                <td>
                                                        <?php
                                                                    $title = $currentItemList[$attr['aId']]['title'];
                                                                    if(in_array(1,$attr[extSelect])){
                                                                            $url = $currentItemList[$attr['aId']]['url'];
                                                                            if(strpos($url,'http://')===false){
                                                                                    $url = "http://".$url;
                                                                            }
                                                                           $title = "<a href=\"$url\" target=\"_blank\">".$title."</a>";
                                                                    }
                                                                    if(in_array(2,$attr[extSelect])){
                                                                            $pic = $currentItemList[$attr['aId']]['pic'];
                                                                            $title = $title."<span style=\"margin-left: 5px;\">[<a href=\"$pic\" style=\"color: red;\" target=\"_blank\">图</a>]</span>";
                                                                    }
                                                            echo $title;
                                                        ?>
                                                </td>
                                            </tr>
                                        <?php }?>
                                    </table>
                        </td>
                        <td width="20%"><?=$list['moduleName']?></td>
                        <td width="10%"><?=($list['extName'])?$list['extName']:'-';?></td>
                        <td width="5%"><?=$list['rank']?></td>
                        <td width="10%"><?=$statusType[$list['del']];?></td>
                        <td  width="35%">
                             <a href="<?=U('HomeLayout/moduleItemCurd',array('curdType'=>'edit','itemId'=>$list['itemId']))?>">节点修改</a>
                            <input type="button" value="<?=$statusType[(!$list['del'])]?>" onclick="javascript:comfirm_del('<?=$list[itemId]?>',this,'<?=$list[del]?>');">
                        </td>
                    </tr>
                    <?php }?>
                </table>
                <div class="cut-page">{$page}</div>
            </div>
        </div>
    </div>
</div>
<script>
    function comfirm_del(itemId,dom,status){
        var jDom= $(dom);
        var status = status;
        if(confirm('是否确定改变此节点状态')){
            $.ajax({
                url:"{:U('HomeLayout/moduleItemDel')}",
                data:{
                    itemId:itemId
                },
                type:'post',
                success:function(msg){
                    if(msg.status==1){
                        console.log(jDom.text());

                        if(msg.del == 1){
                            jDom.val('启用');
                            jDom.parent().prev().text('停用');
                        }else{
                            jDom.val('停用');
                            jDom.parent().prev().text('启用');
                        }
                        alert('状态已改变');
                    }
                },
                dataType:'json'
            });
        }else{
            return false;
        }
    }
</script>