<!DOCTYPE html>
<html>
    <head>
        <title>会员支付明细</title>
        <meta charset="GBK">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <include file="./Tpl/Admin/Public/comm_css_js.html" />
    </head>
    <body>
        <div>{$form}</div>
        <textarea id="last_filter_text" style="display: none">{$lastFilter}</textarea>
        <script type="text/javascript">
            //通过付款详情退款
            $("#refund_by_details").click(function(){
                var pay_id = new Array();
                var i = 0;
                $("input[name='checkedtd']:checkbox").each(function() 
                {   
                    if ($(this).prop("checked") == true) 
                    {  
                       pay_id[i] = $(this).val();  
                       i += 1;
                    }
                }); 

                if( i == 0 )
                {   
                    layer.alert('请至少选择一条付款明细', {icon: 2});
                    return false;
                }

                $.ajax({
                    type: "GET",
                    url: "{:U('MemberRefund/apply_refund')}",
                    data:{'pay_id':pay_id,'refund_method':'pay_details'},
                    dataType:"JSON",
                    success:function(data){
                        if(data.state == 0)
                        {
                           layer.alert(data.msg, {icon: 2});
                        }
                        else if(data.state == 1)
                        {
                           layer.alert(data.msg, {icon: 1},function(){window.location.reload();});
                        }
                        else
                        {
                            var msg = data.msg ? data.msg : '操作异常';
                           layer.alert(msg, {icon: 2});
                        }
                    }
                 })   
            })
      </script>
    </body>
</html>