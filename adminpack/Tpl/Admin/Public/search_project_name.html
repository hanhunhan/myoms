<style>
    .ui-autocomplete-input {
        background-image: none;
    }
</style>
<script>
    // --- begin 报表搜索项目
    $(function () {
        function split(val) {
            return val.split(/,\s*/);
        }

        function extractLast(term) {
            return split(term).pop();
        }

        $("#search_prjname")
                .bind("keydown", function (event) {
                    if (event.keyCode === $.ui.keyCode.TAB &&
                            $(this).data("ui-autocomplete").menu.active) {
                        event.preventDefault();
                    }
                })
                .autocomplete({
                    source: function (request, response) {
                        var keyword = extractLast(request.term);
                        $.ajax({
                            url: "{:U('Project/asyncGetDSProjects')}",
                            type: "GET",
                            dataType: "JSON",
                            data: {keyword: keyword},
                            success: function (data) {
                                if (data.status == 'noauth') {
                                    alert(data.msg);
                                    location.reload();
                                } else {
                                    //判断返回数据是否为空，不为空返回数据。
                                    if (data[0]['id'] > 0) {
                                        response(data);
                                    } else {
                                        response(data);
                                    }
                                }
                            }
                        });
                    },
                    minLength: 1,
                    removeinput: 0,
                    select: function (event, ui) {
                        var terms = split(this.value);
                        // 移除当前输入
                        terms.pop();
                        // 添加被选项
                        terms.push(ui.item.value);
                        // 添加占位符，在结尾添加逗号+空格
                        terms.push("");
                        this.value = terms.join(", ");
                        return false;
                    },
                    focus: function () {
                        return false;
                    },
                    close: function (event) {
                    }
                });


    });
    // -- end 报表搜索项目
</script>