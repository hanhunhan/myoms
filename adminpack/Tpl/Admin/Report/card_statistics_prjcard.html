<!DOCTYPE html>
<html>
<head>
    <title>项目办卡量</title>
    <meta charset="GBK">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="./Public/css/style2.css" type="text/css" rel="stylesheet"/>
    <link href="./Public/css/jquery-ui.css" type="text/css" rel="stylesheet"/>
    <script type="text/javascript" src="./Public/validform/js/jquery-1.9.1.min.js"></script>
    <script type="text/javascript" src="./Public/validform/js/Validform_v5.3.2.js"></script>
    <script type="text/javascript" src="./Public/validform/js/common.js"></script>
    <script type="text/javascript" src="./Public/js/common.js"></script>

    <script language="javascript" type="text/javascript" src="./Public/My97DatePicker/WdatePicker.js"></script>

    <script type="text/javascript" src="./Public/validform/plugin/swfupload/swfuploadv2.2.js"></script>
    <script type="text/javascript" src="./Public/validform/plugin/swfupload/Validform.swfupload.handler.js"></script>
    <script type="text/javascript" src="./Public/js/jquery-ui.js"></script>

    <link rel="stylesheet" href="./Public/validform/css/style.css" type="text/css" media="all"/>
    <link rel="stylesheet" href="./Public/validform/css/validateForm.css" type="text/css" media="all"/>
    <link rel="stylesheet" href="./Public/css/report.css" type="text/css" media="all"/>
    <style>
        html {
            overflow: auto;
        }

        .jbtab th {
            background: none repeat scroll 0 0 #349ac0;
            color: #fff;
            padding: 5px 0;
        }

        .jbtab td {
            border: 1px solid #e1e1e1;
            padding: 10px 0;
        }

        .kctjbot input {
            height: 30px;
            line-height: 30px;
        }

        .smalltext {
            text-align: right;
            color: brown;
            float: right;
            padding-right: 10px;
        }

        .bdtj {
            font-size: 14px;
            line-height: 50px;;
        }

        .bdtj select {
            width: 200px;
            height: 28px;
        }

        .sm_blue {
            color: white;
            background-color: #349ac0;
        }
    </style>
</head>
<body>
<script type="text/javascript">
    /**隔行变色**/
    function changColor() {
        var table_Element = document.getElementById("table_style");
        var tr_Element = table_Element.rows;
        for (var i = 0; i < tr_Element.length; i++) {
            if (i % 2 == 0) {
                if (tr_Element[i].className)
                    tr_Element[i].className += " bgf0";
                else
                    tr_Element[i].className = "bgf0";
            } else {
                if (tr_Element[i].className)
                    tr_Element[i].className += " bgfff";
                else
                    tr_Element[i].className = "bgfff";
            }
        }
    }
    ;

    /**当页面加载时执行**/
    window.onload = function () {
        changColor();
    };
</script>

<div class="containter">
    <div class="right fright j-right">
        <form id="search_form" action="__ACTION__" method="post">
            <table cellpadding="0" cellspacing="0" width="100%" class="bdtj">
                <tr>
                    <td align="right">查询日期：&nbsp;</td>
                    <td>
                        <input type="text" name="search_btime" id="search_btime" class="width105"
                               onfocus="WdatePicker({dateFmt:'yyyy-MM-dd',alwaysUseStartDate:true})"
                               value="{$search_btime}"/>
                        &nbsp;-&nbsp;
                        <input type="text" name="search_etime" id="search_etime" class="width105"
                               onfocus="WdatePicker({dateFmt:'yyyy-MM-dd',alwaysUseStartDate:true})"
                               value="{$search_etime}"/>
                    </td>
                    <td width="8%" align="right">筛选条件：&nbsp;</td>
                    <td width="32%">
                        <select id="search_cardcon" name="search_cardcon" class="fl" style="width:200px">
                            <?php foreach($cardCondition as $key=>$val){ ?>
                            <option value="{$key}" <?php echo($search_cardcon == $key ? 'selected' : ''); ?>>{$val}</option>
                            <?php } ?>
                        </select>
                    </td>
                </tr>

                <tr>
                    <td align="right">项目搜索：&nbsp;</td>
                    <td>
                        <input type="text" name="search_prjname" id="search_prjname" class="width105"
                               value="{$search_prjname}"/>
                    </td>
                    <td width="8%" align="right">显示方式：&nbsp;</td>
                    <td width="32%">
                        <select id="search_cardshow" name="search_cardshow" class="fl" style="width:200px">
                            <?php foreach($cardShow as $key=>$val){ ?>
                            <option value="{$key}"
                            <?php echo($search_cardshow == $key ? 'selected' : ''); ?>>{$val}</option>
                            <?php } ?>
                        </select>
                    </td>
                </tr>

                <tr>
                    <td align="right">排序方式：&nbsp;</td>
                    <td>
                        <select id="search_cardorder" name="search_cardorder" class="fl" style="width:200px">
                            <?php foreach($cardOrder as $key=>$val){ ?>
                            <option value="{$key}"
                            <?php echo($search_cardorder == $key ? 'selected' : ''); ?>>{$val}</option>
                            <?php } ?>
                        </select>
                    </td>
                    <td width="8%" align="right"></td>
                    <td width="32%"></td>
                </tr>

            </table>

            <div class="kctjbot">
                <input type="hidden" name="act" value="{$act}"/>
                <input type="submit" class="btn139 sm_blue" value="查 询"/>
            </div>

        </form>

        <div class="contractinfo-table">
            <div class="brdbt">
                <a style="float: right; font-size: 13px;margin-bottom: 5px;" class="btn139 sm_blue" target="_blank"  target="_blank" href="<?=$pageurl . '&export=1'?>"><导出数据</a>
            </div>
            <?php if($search_cardshow==0){ ?>
                <?php echo $html; ?>
            <?php } else if($search_cardshow==1) {?>
                <?php echo $html; ?>
            <?php } ?>
            <p class="pagenum">{$page_nav}</p>
        </div>
    </div>
</div>
<style>
    .ui-autocomplete-input {
        background-image: none;
    }
</style>
<script>
    // --- begin 报表搜索项目
    $(function () {
        function split(val) {
            return val.split(/,\s*/);
        }

        function extractLast(term) {
            return split(term).pop();
        }

        $("#search_prjname")
                .bind("keydown", function (event) {
                    if (event.keyCode === $.ui.keyCode.TAB &&
                            $(this).data("ui-autocomplete").menu.active) {
                        event.preventDefault();
                    }
                })
                .autocomplete({
                    source: function (request, response) {
                        var keyword = extractLast(request.term);
                        $.ajax({
                            url: "{:U('Project/asyncGetDSProjects')}",
                            type: "GET",
                            dataType: "JSON",
                            data: {keyword: keyword},
                            success: function (data) {
                                if (data.status == 'noauth') {
                                    alert(data.msg);
                                    window.location.href = window.location.href;
                                } else {
                                    //判断返回数据是否为空，不为空返回数据。
                                    if (data[0]['id'] > 0) {
                                        response(data);
                                    } else {
                                        response(data);
                                    }
                                }
                            }
                        });
                    },
                    minLength: 1,
                    removeinput: 0,
                    select: function (event, ui) {
                        this.value = ui.item.value;
                        return false;
                    },
                    focus: function () {
                        return false;
                    },
                    close: function (event) {
                    }
                });

    });
    // -- end 报表搜索项目
</script>
</body>
</html>