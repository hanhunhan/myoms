<!DOCTYPE html>
<html>
    <head>
        <title>仓库管理</title>
        <meta charset="GBK">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <!--<link href="./Public/css/style2.css" type="text/css" rel="stylesheet"/>-->
        <!--<script type="text/javascript" src="./Public/validform/js/jquery-1.9.1.min.js"></script>-->
        <!--<script type="text/javascript" src="./Public/validform/js/Validform_v5.3.2.js"></script>-->
        <!--<script type="text/javascript" src="./Public/validform/js/common.js"></script>-->
        <!--<script type="text/javascript" src="./Public/js/common.js"></script>-->
        <!--<script language="javascript" type="text/javascript" src="./Public/My97DatePicker/WdatePicker.js"></script>		-->
		<!--<script language="javascript" type="text/javascript" src="./Public/layer/layer.js"></script>-->
        <!--<link rel="stylesheet" href="./Public/validform/css/style.css" type="text/css" media="all" />-->
        <!--<link rel="stylesheet" href="./Public/validform/css/validateForm.css" type="text/css" media="all" />-->
        <include file="./Tpl/Admin/Public/comm_css_js.html" />
    </head>
    <body>
    <div class="containter">
        <div class="right fright j-right">
            <div class="handle-tab">{$tabs}</div>
            <div>{$form}</div>
        </div>
    </div>
        <script type="text/javascript">
        
        /*申请退库*/
        $("#confirm_to_warehouse").click(function()
        {   
            var warehouse_id = new Array();
            var i = 0;
            $("input[name= 'checkedtd']:checkbox").each(function() 
            {   
                if ($(this).prop("checked") == true) 
                {  
                    warehouse_id[i] = $(this).val();  
                    i += 1;
                }
            });
            
            if( i == 0 )
            {   
                layer.alert('请至少选择一条退库记录', {icon: 2});
                return false;
            }
           
            layer.confirm(
                '确定退库吗？',
                {title: '确定退库'},
                function(index)
                { 
                    $.ajax({
                        type: "POST",
                        url: "index.php?s=/Warehouse/confirm_to_warehouse",
                        data:{'warehouse_id' : warehouse_id},
                        dataType:"JSON",
                        success:function(data)
                        {
                            if(data.state == 1)
                            {
                                layer.alert(data.msg, {icon: 1, closeBtn: false}, 
                                function(){layer.close(index);window.location.reload();});
                            }
                            else if(data.state == 0)
                            {
                                layer.alert(data.msg, {icon: 2, closeBtn: false}, 
                                function(){layer.close(index);window.location.reload();});
                            }
                            else
                            {
                                var msg = data.msg ? data.msg : '操作异常';
                                layer.alert(msg, {icon: 2, closeBtn: false},
                                function(){layer.close(index);window.location.reload();});
                            }
                        }
                    })
                }
            );
        })
        
        /*打回申请*/
        $("#send_back").click(function()
        {   
            var warehouse_id = new Array();
            var i = 0;
            $("input[name= 'checkedtd']:checkbox").each(function() 
            {   
                if ($(this).prop("checked") == true) 
                {  
                	warehouse_id[i] = $(this).val();  
                    i += 1;
                }
            });
            
            if( i == 0 )
            {   
                layer.alert('请至少选择一条退库记录', {icon: 2});
                return false;
            }
            
            layer.confirm(
                '确定打回申请吗？',
                {title: '确定打回申请'},
                function(index)
                { 
                    $.ajax({
                        type: "POST",
                        url: "index.php?s=/Warehouse/application_send_back",
                        data:{'warehouse_id' : warehouse_id},
                        dataType:"JSON",
                        success:function(data)
                        {
                            if(data.state == 1)
                            {
                                layer.alert(data.msg, {icon: 1, closeBtn: false}, 
                                function(){layer.close(index);window.location.reload();});
                            }
                            else if(data.state == 0)
                            {
                                layer.alert(data.msg, {icon: 2, closeBtn: false}, 
                                function(){layer.close(index);window.location.reload();});
                            }
                            else
                            {
                                var msg = data.msg ? data.msg : '操作异常';
                                layer.alert(msg, {icon: 2, closeBtn: false},
                                function(){layer.close(index);window.location.reload();});
                            }
                        }
                    })
                }
            );
        })
    </script>
    <include file="./Tpl/Admin/Public/filter.html" />
    </body>
</html>