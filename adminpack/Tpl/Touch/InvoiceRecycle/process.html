<!DOCTYPE html>
<html>
<head>
    <include file="Tpl/Touch/Public/head.html" />
    <title>{$title}</title>
</head>
<body>
    <div class="head jumbotron">
        <div class="container">
            <h3>{$processTitle}</h3>
            <span class="label label-danger" {$labelStyle}>{$title}</span>
            <small>{$applicationTime}</small>
            <include file="Tpl/Touch/Public/back_btn_box.html" />
        </div>
    </div>

    <div class="main">
        <div class="container">
            <input type ="hidden" id="invoice_recycle_list_id" value ="{$recordId}">
            <!--申请说明-->
            <include file="Tpl/Touch/Public/application_info.html" />

            <div class="panel panel-primary">
                <a name="recycle-invoice-list"></a>
                <div class="panel-heading"><i class="glyphicon glyphicon-list-alt"></i>&nbsp;退票列表</div>
                <div class="table-responsive">
                    <table class="table table-bordered">
                        <thead>
                        <tr>
                            <th class="text-center">序号</th>
                            <th class="text-center">项目名称</th>
                            <th class="text-center">联系人</th>
                            <th class="text-center">联系方式</th>
                            <th class="text-center">申请人</th>
                            <th class="text-center">申请时间</th>
                            <th class="text-center">收据编号</th>
                            <th class="text-center">发票编号</th>
                            <th class="text-center">发票状态</th>
                            <?php if($myTurn){ ?>
                            <th class="text-center">操作</th>
                            <?php } ?>
                        </tr>
                        </thead>
                        <tbody>
                        <volist name="viewData['recycleInfo']" id="recycleInfo" key="k">
                            <tr>
                                <td class="text-center">{$k}</td>
                                <td class="text-center">{$recycleInfo['PROJECTNAME']}</td>
                                <td class="text-center">{$recycleInfo['REALNAME']}</td>
                                <td class="text-center">{$recycleInfo['MOBILENO']}</td>
                                <td class="text-center">{$recycleInfo['USERNAME']}</td>
                                <td class="text-center"><?=oracle_date_format($recycleInfo['APPLY_TIME'],"Y-m-d")?></td>
                                <td class="text-center">{$recycleInfo['RECEIPT_NO']}</td>
                                <td class="text-center">{$recycleInfo['INVOICE_NO']}</td>                               
                                <td class="text-center">{$viewData['invoiceStatus']['INVOICE_STATUS'][$recycleInfo['INVOICE_STATUS']]}</td>
                                <?php if($myTurn){ ?>
                                <td class="text-center"><a href="javascript:;" realname="{$recycleInfo['REALNAME']}" id="{$recycleInfo['ID']}" class="revoke_invoice_recycle btn btn-danger btn-xs">撤销退票</a></td>
                                <?php } ?>
                            </tr>
                        </volist>
                        </tbody>
                    </table>
                </div>
            </div>
            <p class="ps-text">注：横向拖动表格可查看完整数据</p>
            <div class="pull-right" style="margin-top: -15px; margin-bottom: 10px;"><a href="javascript:void(0);" id="export_recycle" class="btn btn-danger btn-sm">导出退票单</a></div>
            <br/>
            <!--流程图-->
            <include file="Tpl/Touch/Public/work_flows.html" />
            <!--审批意见-->
            <include file="Tpl/Touch/Public/opinion_flow.html" />
        </div>
    </div>

    <div class="foot">
        <!--菜单-->
        <include file="Tpl/Touch/Public/menu.html" />
        <!--用户选择列表-->
        <include file="Tpl/Touch/Public/user_list.html" />

    </div>
<include file="Tpl/Touch/Public/foot.html" />
    <script type="application/javascript">
        //撤销退票
        $(".revoke_invoice_recycle").click(function()
        {
            var invoiceRecycleId = $(this).attr('id');
            var invoiceRecycleRealName = $(this).attr('realname');

            if(invoiceRecycleId > 0)
            {
                if(!confirm("亲，确定撤销此条退票？"))
                    return false;

                var _this = $(this);

                $.ajax({
                    type: "POST",
                    url: "{:U('InvoiceRecycle/revoke_invoice_recycle')}",
                    data:{'invoiceRecycleId' : invoiceRecycleId},
                    dataType:"JSON",
                    success:function(data){
                        layer.alert(invoiceRecycleRealName+'撤销退票成功', {icon: 1, closeBtn: false},
                                        function(){_this.parent().parent().remove();window.location.reload();});
                    },
                    error:function(data){

                    },
                });
            }
        });
        //导出退票
        $('#export_recycle').click(function() {
            var filter_sql = "<php>echo $filter_sql;</php>";
            var list_id = $('#invoice_recycle_list_id').val();
            window.location.href = "index.php?s=/InvoiceRecycle/export_recycle/list_id/" + list_id + "&Filter_Sql=" + filter_sql;
                                   // "index.php?s=/Financial/exportInvoice/member_id/" + member_id + "&Filter_Sql=" + filter_sql;
        });
    </script>
</body>
</html>