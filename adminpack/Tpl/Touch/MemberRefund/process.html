<!DOCTYPE html>
<html>
<head>
    <include file="Tpl/Touch/Public/head.html" />
    <title>{$title}</title>
</head>
<body>
    <div class="head jumbotron">
        <div class="container">
            <h3>{$processTitle}</h3>
            <span class="label label-danger" {$labelStyle}>{$title}</span>
            <small>{$applicationTime}</small>
            <include file="Tpl/Touch/Public/back_btn_box.html" />
        </div>
    </div>

    <div class="main">
        <div class="container">
            <!--申请说明-->
            <include file="Tpl/Touch/Public/application_info.html" />

            <div class="panel panel-primary">
                <a name="refund-list"></a>
                <div class="panel-heading"><i class="glyphicon glyphicon-list-alt"></i>&nbsp;退款列表</div>
                <div class="table-responsive">
                    <table class="table table-bordered">
                        <thead>
                        <tr>
                            <th class="text-center">序号</th>
                            <th class="text-center">项目名称</th>
                            <th class="text-center">客户姓名</th>
                            <th class="text-center">手机号</th>
                            <th class="text-center">付款方式</th>
                            <th class="text-center">交易金额</th>
                            <th class="text-center">退款金额</th>
                            <th class="text-center">退款申请人</th>
                            <th class="text-center">退款申请时间</th>
                            <th class="text-center">原始交易时间</th>
                            <th class="text-center">银行卡号</th>
                            <th class="text-center">检索号</th>
                            <th class="text-center">收据编号</th>
                            <th class="text-center">发票编号</th>
                            <th class="text-center">商户编号</th>
                            <?php if($myTurn){ ?>
                            <th class="text-center">操作</th>
                            <?php } ?>
                        </tr>
                        </thead>
                        <tbody>
                        <volist name="viewData['refundInfo']" id="refundInfo" key="k">
                            <tr>
                                <td class="text-center">{$k}</td>
                                <td class="text-center">{$refundInfo['PRJ_NAME']}</td>
                                <td class="text-center">{$refundInfo['REALNAME']}</td>
                                <td class="text-center">{$refundInfo['MOBILENO']}</td>
                                <td class="text-center">{$viewData['payType'][$refundInfo['PAY_TYPE']]}</td>
                                <td class="text-center">{$refundInfo['ORIGINAL_MONEY']}</td>
                                <td class="text-center">{$refundInfo['REFUND_MONEY']}</td>
                                <td class="text-center">{$refundInfo['USERNAME']}</td>
                                <td class="text-center"><?=oracle_date_format($refundInfo['CREATETIME'],"Y-m-d")?></td>
                                <td class="text-center"><?=oracle_date_format($refundInfo['TRADE_TIME'],"Y-m-d")?></td>
                                <td class="text-center">{$refundInfo['CVV2']}</td>
                                <td class="text-center">{$refundInfo['RETRIEVAL']}</td>
                                <td class="text-center">{$refundInfo['RECEIPTNO']}</td>
                                <td class="text-center">{$refundInfo['INVOICE_NO']}</td>
                                <td class="text-center">{$refundInfo['MERCHANT_NUMBER']}</td>
                                <?php if($myTurn){ ?>
                                <td class="text-center"><a href="javascript:;" realname="{$refundInfo['REALNAME']}" id="{$refundInfo['ID']}" class="revoke_member_refund btn btn-danger btn-xs">撤销退款</a></td>
                                <?php } ?>
                            </tr>
                        </volist>
                        </tbody>
                    </table>
                </div>
            </div>
            <p class="ps-text">注：横向拖动表格可查看完整数据</p>
            <div class="pull-right" style="margin-top: -15px; margin-bottom: 10px;"><a href="javascript:void(0);" id="export_refunds" class="btn btn-danger btn-sm">导出退款单</a></div>
            <input type="hidden" name ="refund_list_id" id="refund_list_id" value="{$refund_list_id}">

            <div class="panel panel-primary" style="clear: both">
                <a name="refund-total"></a>
                <div class="panel-heading"><i class="glyphicon glyphicon-list-alt"></i>&nbsp;项目汇总</div>
                <div class="table-responsive">
                    <table class="table table-bordered">
                        <thead>
                        <tr>
                            <th class="text-center">项目名称</th>
                            <th class="text-center">退款条数</th>
                            <th class="text-center">项目退款总额</th>
                        </tr>
                        </thead>
                        <tbody>
                        <volist name="projectRefundStat" id="projectRefundStat" key="k">
                            <tr>
                                <td class="text-center">{$projectRefundStat['PROJECTNAME']}</td>
                                <td class="text-center">{$projectRefundStat['TOTAL_COUNT']}</td>
                                <td class="text-center">{$projectRefundStat['TOTAL_AMOUNT']}</td>
                            </tr>
                        </volist>
                        </tbody>
                    </table>
                </div>
            </div>
            <p class="ps-text">注：横向拖动表格可查看完整数据</p>
            <!--流程图-->
            <include file="Tpl/Touch/Public/work_flows.html" />
            <!--审批意见-->
            <include file="Tpl/Touch/Public/opinion_flow.html" />
        </div>
    </div>

    <div class="foot">
        <!--菜单-->
        <include file="Tpl/Touch/Public/menu.html" />
        <!--用户选择列表-->
        <include file="Tpl/Touch/Public/user_list.html" />

    </div>
<include file="Tpl/Touch/Public/foot.html" />
    <script type="application/javascript">
        //撤销退票
        $(".revoke_member_refund").click(function()
        {
            var reund_details_id = $(this).attr('id');
            var refundRealName = $(this).attr('realname');

            if(reund_details_id > 0)
            {
                if(!confirm("亲，确定撤销此条退款吗？"))
                    return false;

                var _this = $(this);

                $.ajax({
                    type: "POST",
                    url: "{:U('MemberRefund/delete_from_audit_list')}",
                    data:{'reund_details_id' : reund_details_id},
                    dataType:"JSON",
                    success:function(data){
                        layer.alert(refundRealName+'撤销退款成功', {icon: 1, closeBtn: false},
                                        function(){_this.parent().parent().remove();window.location.reload();});
                      /*  swal({
                            title: "撤销退款",
                            text: refundRealName + ",撤销退款成功！",
                            animation: false,
                            showCancelButton: false,
                            confirmButtonColor: "#DD6B55",
                            confirmButtonText: "确定",
                            closeOnConfirm: false
                        }, function (isConfirm) {
                            if (isConfirm) {
                                _this.parent().parent().remove();
                                window.location.reload();
                            }
                        });*/
                    },
                    error:function(data){

                    },
                });
            }
        });

        //导出退款审核单
        $('#export_refunds').click(function() {
            var refundListID = $('#refund_list_id').val();
            if (!refundListID) {
                alert('退款进度编号不能为空！');
                return false;
            }
            location.href = "__APP__" + 'MemberRefund/exportRefunds&refund_list_id=' + refundListID;
        });

    </script>
</body>
</html>